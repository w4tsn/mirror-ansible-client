---

.fedora:
  
  stage: test
  variables:
    GIT_STRATEGY: clone
  before_script:
    - 'sudo dnf install -y git ansible'
    - 'sed -i "s/^become_ask_pass = .*/become_ask_pass = False/" ansible.cfg'
  script:
    - 'env ANSIBLE_FORCE_COLOR=1 ansible-playbook -v profile-development.yml --syntax-check'
    - 'env ANSIBLE_FORCE_COLOR=1 ansible-playbook -v profile-development.yml'
    - env ANSIBLE_FORCE_COLOR=1 ansible-playbook -v profile-development.yml | tee ansible.log
    - >
      grep -q 'changed=0.*failed=0' ansible.log
      && (echo 'Idempotence test: pass' && exit 0)
      || (echo 'Idempotence test: fail' && exit 1)

f33:
  extends: .fedora
  image: docker.io/library/fedora:33

f34:
  extends: .fedora
  image: docker.io/library/fedora:34
